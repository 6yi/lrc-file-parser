/*!
 * 
 * Author: lyswhut
 * Email：lyswhut@qq.com
 * Github：https://github.com/lyswhut/lrc-parser
 * License: MIT
 * 
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Lyric=e():t.Lyric=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var s=/^\[([\d|:|\.]*)\]{1}/g,u={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"};t.exports=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lyric=e.lyric,this.tags={},this.lines=null,this.handle=e.onPlay,this.onSetLyric=e.onSetLyric,this.isPlay=!1,this.curLineNum=0,this.timer=0,this.maxLine=0,this._init()}return n(t,[{key:"_init",value:function(){this.lyric&&(this._initTag(),this._initLines(),this.onSetLyric(this.lines))}},{key:"_initTag",value:function(){for(var t in u){var e=this.lyric.match(new RegExp("\\["+u[t]+":([^\\]]*)]","i"));this.tags[t]=e&&e[1]||""}}},{key:"_initLines",value:function(){this.lines=[];for(var t=this.lyric.split("\n"),e=0;e<t.length;e++){var i=t[e].trim();if(s.exec(i)){var n=i.replace(s,"").trim();if(n){var u=RegExp.$1.split(":");u.length<3&&u.unshift(0),u[2].includes(".")&&(u.push.apply(u,r(u[2].split("."))),u.splice(2,1)),this.lines.push({time:60*u[0]*60*1e3+60*u[1]*1e3+1e3*u[2]+10*(u[3]||0),text:n})}}}this.lines.sort(function(t,e){return t.time-e.time}),this.maxLine=this.lines.length-1}},{key:"_findCurLineNum",value:function(t){for(var e=this.lines.length,i=0;i<e;i++)if(t<=this.lines[i].time)return 0===i?0:i-1;return e-1}},{key:"_refresh",value:function(){var t=this;if(this.curLineNum++,this.handle(this.curLineNum,this.lines[this.curLineNum].text),this.curLineNum===this.maxLine)return this.pause();this.timer=setTimeout(function(){t._refresh()},this.lines[this.curLineNum+1].time-this.lines[this.curLineNum].time)}},{key:"play",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.lines.length){if(this.pause(),this.isPlay=!0,this.curLineNum=this._findCurLineNum(e),this.handle(this.curLineNum,this.lines[this.curLineNum].text),this.curLineNum===this.maxLine)return this.pause();this.delay=this.lines[this.curLineNum+1].time-e,this.delay<0||(this.timer=setTimeout(function(){t._refresh()},this.delay))}}},{key:"pause",value:function(){this.isPlay&&(clearTimeout(this.timer),this.isPlay=!1)}},{key:"setLyric",value:function(t){this.isPlay&&this.pause(),this.lyric=t,this._init()}}]),t}()}])});