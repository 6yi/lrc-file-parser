/*!
 * lrc-file-parser.js v0.1.6
 * Author: lyswhut
 * Github: https://github.com/lyswhut/lrc-file-parser
 * License: MIT
 */
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("Lyric",[],i):"object"==typeof exports?exports.Lyric=i():t.Lyric=i()}(window,function(){return function(t){var i={};function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";var n=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();function s(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)}var r=/^\[([\d|:|\.]*)\]{1}/g,u={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"};t.exports=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=i.lyric,n=void 0===e?"":e,s=i.offset,r=void 0===s?190:s,u=i.onPlay,o=void 0===u?function(){}:u,f=i.onSetLyric,l=void 0===f?function(){}:f;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.lyric=n,this.tags={},this.lines=null,this.onPlay=o,this.onSetLyric=l,this.isPlay=!1,this.curLineNum=0,this.timer=0,this.maxLine=0,this.offset=r,this.isOffseted=!1,this._init()}return n(t,[{key:"_init",value:function(){this.lyric&&(this._initTag(),this._initLines(),this.onSetLyric(this.lines))}},{key:"_initTag",value:function(){for(var t in u){var i=this.lyric.match(new RegExp("\\["+u[t]+":([^\\]]*)]","i"));this.tags[t]=i&&i[1]||""}}},{key:"_initLines",value:function(){this.lines=[];for(var t=this.lyric.split("\n"),i=0;i<t.length;i++){var e=t[i].trim();if(r.exec(e)){var n=e.replace(r,"").trim();if(n){var u=RegExp.$1.split(":");u.length<3&&u.unshift(0),u[2].includes(".")&&(u.push.apply(u,s(u[2].split("."))),u.splice(2,1)),this.lines.push({time:60*u[0]*60*1e3+60*u[1]*1e3+1e3*u[2]+10*(u[3]||0),text:n})}}}this.lines.sort(function(t,i){return t.time-i.time}),this.maxLine=this.lines.length-1}},{key:"_findCurLineNum",value:function(t){for(var i=this.lines.length,e=0;e<i;e++)if(t<=this.lines[e].time)return 0===e?0:e-1;return i-1}},{key:"_refresh",value:function(){var t=this;if(this.curLineNum++,this.onPlay(this.curLineNum,this.lines[this.curLineNum].text),this.curLineNum===this.maxLine)return this.pause();this.delay=this.lines[this.curLineNum+1].time-this.lines[this.curLineNum].time,!this.isOffseted&&this.delay>=this.offset&&(this.delay-=this.offset,this.isOffseted=!0),this.timer=setTimeout(function(){t._refresh()},this.delay)}},{key:"play",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.lines.length){if(this.pause(),this.isPlay=!0,this.curLineNum=this._findCurLineNum(i),this.onPlay(this.curLineNum,this.lines[this.curLineNum].text),this.curLineNum===this.maxLine)return this.pause();this.delay=this.lines[this.curLineNum+1].time-i,this.delay>=this.offset&&(this.delay-=this.offset,this.isOffseted=!0),this.delay<0||(this.timer=setTimeout(function(){t._refresh()},this.delay))}}},{key:"pause",value:function(){this.isPlay&&(clearTimeout(this.timer),this.isPlay=!1,this.isOffseted=!1)}},{key:"setLyric",value:function(t){this.isPlay&&this.pause(),this.lyric=t,this._init()}}]),t}()}])});